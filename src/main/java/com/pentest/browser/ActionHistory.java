package com.pentest.browser;

import java.util.ArrayList;
import java.util.List;
import java.time.Instant;

public class ActionHistory {
    public static class Action {
        private final String type;
        private final String description;
        private final Instant timestamp;
        private final String result;
        
        public Action(String type, String description, String result) {
            this.type = type;
            this.description = description;
            this.timestamp = Instant.now();
            this.result = result;
        }
        
        public String getType() { return type; }
        public String getDescription() { return description; }
        public Instant getTimestamp() { return timestamp; }
        public String getResult() { return result; }
        
        @Override
        public String toString() {
            return String.format("[%s] %s: %s -> %s", 
                timestamp, type, description, 
                result != null ? result.substring(0, Math.min(100, result.length())) + "..." : "null");
        }
    }
    
    private final List<Action> actions;
    private final String userPrompt;
    private String identifiedGoal;
    private int turnCount;
    
    public ActionHistory(String userPrompt) {
        this.actions = new ArrayList<>();
        this.userPrompt = userPrompt;
        this.turnCount = 0;
    }
    
    public void addAction(String type, String description, String result) {
        actions.add(new Action(type, description, result));
    }
    
    public void setIdentifiedGoal(String goal) {
        this.identifiedGoal = goal;
    }
    
    public String getIdentifiedGoal() {
        return identifiedGoal;
    }
    
    public String getUserPrompt() {
        return userPrompt;
    }
    
    public List<Action> getActions() {
        return new ArrayList<>(actions);
    }
    
    public int incrementTurn() {
        return ++turnCount;
    }
    
    public int getTurnCount() {
        return turnCount;
    }
    
    public String getContextForPrompt() {
        StringBuilder context = new StringBuilder();
        context.append("=== Context ===\n");
        context.append("User Prompt: ").append(userPrompt).append("\n");
        context.append("Identified Goal: ").append(identifiedGoal).append("\n\n");
        
        context.append("=== Action History ===\n");
        for (Action action : actions) {
            context.append("- ").append(action.toString()).append("\n");
        }
        
        return context.toString();
    }
} 